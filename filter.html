<!DOCTYPE html>
<html lang="en-US">
 <head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
	<title>Filter</title>
	<style> 
	body {
		font-family:verdana;
		font-size:14px;
	}
	.container {
		width:100%;
		max-width:1170px;
		min-width:0;
		background-color:#f1f1f1;
		box-shadow:0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
		margin: 50px auto;
	}
	.codecontainer {
		width:30%;
		float:left;
	}
	#filters {
		display: none;
	}
	.codecontainer .radio {
		line-height:2;
	}
	.resultcontainer {
		width:68%;
		float:left;
	}
	.playit {
		background-color:#ffffff;
		padding:15px;
		margin:15px;
		margin-top:0;
		font-family:Consolas,'Courier New', Courier, monospace;
		font-size:16px;
	}
	#enlargecssprop {
		font-weight:bold;
		color:#000000;
	}
	#demoDIV {
		margin-left:10px;
		margin-top:3px;
		margin-right:15px;
		background-color:#ffffff;
		border:1px solid #c3c3c3;
		height:340px;
		text-align: center;
	}
	img#myImg {
		filter: blur(5px);
	} 
	#styleDIV {
		font-family:consolas,Courier new;
		font-size:14px;
		margin-left:10px;
		margin-right:15px;
		background-color:#ffffff;
		padding:10px;
		color:#222222;
		text-align:left;
	}
	div.demoHeader {
		font-size:24px;
		margin-top:15px;
		margin-left:15px;
		margin-bottom:15px;
		color:#555555;
	}	 
	img#myImg {
		-webkit-filter:blur(5px);
		width:300px;
		margin: 20px auto;
	}
	.canvasDisplay {
		width: 300px;
		height: 300px;
		display: none;
		margin: 20px auto;
	}
	</style>
</head>
<body>
<div id="container" class="container">
	<div class="codecontainer">
		<div class="demoHeader">CSS Property:</div>
		<form id="filters" class="playit" action="javascript:return false;">
					Filter:<br><br>
			<input type="hidden" id="preselectedValue" value="none" />
		
			<div class="radio"><input autocomplete="off" type="radio" name="radio_position" onclick="click_position(this)" id="value_1" value="none" checked/><label for="value_1">none</label></div>
		 
			<div class="radio"><input autocomplete="off" type="radio" name="radio_position" onclick="click_position(this)" id="value_2" value="blur" /><label for="value_2">blur(5px)</label></div>
		
			<div class="radio"><input autocomplete="off" type="radio" name="radio_position" onclick="click_position(this)" id="value_3" value="brightness" /><label for="value_3">brightness(200%)</label></div>
		
			<div class="radio"><input autocomplete="off" type="radio" name="radio_position" onclick="click_position(this)" id="value_4" value="contrast" /><label for="value_4">contrast(200%)</label></div>
		
			<!--div class="radio"><input autocomplete="off" type="radio" name="radio_position" onclick="click_position(this)" id="value_5" value="shadow" /><label for="value_5">shadow(5px 5px 5px red)</label></div-->
			
			<div class="radio"><input autocomplete="off" type="radio" name="radio_position" onclick="click_position(this)" id="value_6" value="boxShadow" /><label for="value_6">boxShadow(5px 5px 5px red)</label></div>
			
			<!--div class="radio"><input autocomplete="off" type="radio" name="radio_position" onclick="click_position(this)" id="value_7" value="dropShadow" /><label for="value_7">dropShadow(5px 5px 5px red)</label></div-->
		
			<div class="radio"><input autocomplete="off" type="radio" name="radio_position" onclick="click_position(this)" id="value_8" value="grayscale" /><label for="value_8">grayscale(100%)</label></div>
		
			<div class="radio"><input autocomplete="off" type="radio" name="radio_position" onclick="click_position(this)" id="value_9" value="huerotate" /><label for="value_9">hue-rotate(90deg)</label></div>
		
			<div class="radio"><input autocomplete="off" type="radio" name="radio_position" onclick="click_position(this)" id="value_10" value="invert" /><label for="value_10">invert(100%)</label></div>
		
			<div class="radio"><input autocomplete="off" type="radio" name="radio_position" onclick="click_position(this)" id="value_11" value="opacity" /><label for="value_11">opacity(50%)</label></div>
					
			<div class="radio"><input autocomplete="off" type="radio" name="radio_position" onclick="click_position(this)" id="value_13" value="saturate" /><label for="value_13">saturate(8)</label></div>
		
			<div class="radio"><input autocomplete="off" type="radio" name="radio_position" onclick="click_position(this)" id="value_14" value="sepia" /><label for="value_14">sepia(100%)</label></div>
		  
		</form>
	</div>
	<div class="resultcontainer">
		<div class="demoHeader">Result:</div>
	 
		<div id="demoParent">
			<div id="demoDIV">
				<img id="myImg" src="img/pineapple.jpg"/>
				<canvas id="blur" class="canvasDisplay"></canvas>
				<canvas id="brightness" class="canvasDisplay"></canvas>
				<canvas id="contrast" class="canvasDisplay"></canvas>
				<canvas id="grayscale" class="canvasDisplay"></canvas>
				<canvas id="huerotate" class="canvasDisplay"></canvas>
				<canvas id="invert" class="canvasDisplay"></canvas>
				<canvas id="opacity" class="canvasDisplay"></canvas>
				<canvas id="saturate" class="canvasDisplay"></canvas>
				<canvas id="sepia" class="canvasDisplay"></canvas>
			</div>
		</div>
		<div class="demoHeader">Code:</div>
		<pre id="styleDIV">
			img#myImg {<br>        filter:<span id='enlargecssprop'> blur(5px)</span>;<br>}<br>
		</pre>
	</div>
	<div style="clear:both;"></div>
	<script type="text/javascript">
    var img 	= document.getElementById('myImg'),
    	canvases= document.getElementsByClassName("canvasDisplay");
    
	var filter = {
		"boxShadow"	:	"5px 5px 5px #F00",
		"none"		:	"none",
	};
	
	playit_onload();
	function click_position(obj) {
		change_position(obj.value)
	}
	 
	function change_position(key) {
		var s="myImg ",
			s=s.trim();
		
		hiddenOther(key);
		
		if(key=="blur" || key=="brightness" || key=="contrast" || key=="grayscale" || key=="huerotate" 
			|| key=="invert" || key=="opacity" || key=="saturate" || key=="sepia") {
			document.getElementById("styleDIV").innerHTML="<h3>Built by JS function!</h3>";
			window[key]();
			//eval(key).call();
		} else {
			img.style.display = 'inline';
			val = filter[key];
			if(key=="boxShadow") {
				img.style.filter="none";
				img.style.WebkitFilter="none";
				img.style.boxShadow=val;
				img.style.WebkitBoxShadow=val;
				img.style.MozBoxShadow=val;
			} else {
				if(img.style.boxShadow);
					img.style.boxShadow="";
				img.style.filter=val;
				img.style.WebkitFilter=val;
			}
			var y="img#myImg {<br>  filter: ###CSSPROP###;<br>}<br>";
			var z=y.replace("###CSSPROP###",val);
		 
			document.getElementById("styleDIV").innerHTML=z;
		}
	}
	
	if (!String.prototype.trim) {
	   String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g, '');};
	}
	
	function playit_onload() {
		var preval="";
		preval=document.getElementById("preselectedValue").value;
		if (preval!="") {
			change_position(preval);
			var x=document.getElementsByTagName("input");
			var l=x.length;
			for (i=0;i<l;i++) {
				if (x[i].value==preval) {
					x[i].checked=true
				}
			}
		}
	}

	
	/** Visual Filters **/
    //img.addEventListener('load', function() {
      //var canvases = document.getElementsByTagName('canvas');
	  hiddenOther(false);

      function runFilter(id, filter, arg1, arg2, arg3) {
        var c = document.getElementById(id);
        //var s = c.previousSibling.style;
		var s = img.style; idata = Filters.filterImage(filter, img, arg1, arg2, arg3);
		c.width = idata.width;
		c.height = idata.height;
		var ctx = c.getContext('2d');
		ctx.putImageData(idata, 0, 0);
		if(id=="opacity") {
			ctx.globalAlpha = arg1;
			ctx.fillStyle = "black";
			ctx.fillRect(0, 0, c.width, c.height);
		}
		s.display = 'none';
		c.style.display = 'inline';
      }
      
	  blur = function() {
		runFilter('blur', Filters.convolute,
		  [ 1/30, 1/90, 1/30,
		    1/30, 1/39, 1/30,
		    1/30, 1/30, 1/30 ]);
  	  }
  	  
      brightness = function() {
        runFilter('brightness', Filters.brightness, 50);
      }

      contrast = function() {
        runFilter('contrast', Filters.contrast, 100);
      }
	  
      grayscale = function() {
        runFilter('grayscale', Filters.grayscale, 50);
      }

      huerotate = function() {
        runFilter('huerotate', Filters.huerotate, 0.25);
      }
      
      huerotate = function() {
        runFilter('huerotate', Filters.huerotate, 0.25);
      }
      
      invert = function() {
        runFilter('invert', Filters.invert, 100);
      }
	  
      opacity = function() {
        runFilter('opacity', Filters.opacity, 0.5);
      }
      
      saturate = function() {
        runFilter('saturate', Filters.saturate, 8);
      }
	  
      sepia = function() {
        runFilter('sepia', Filters.sepia, 18);
      }
    //}, false);
	
	
	Filters = {};
	Filters.getPixels = function(img) {
	  var c,ctx;
	  if (img.getContext) {
		c = img;
		try { ctx = c.getContext('2d'); } catch(e) {}
	  }
	  if (!ctx) {
		c = this.getCanvas(img.width, img.height);
		ctx = c.getContext('2d');
		ctx.drawImage(img, 0, 0);
	  }
	  return ctx.getImageData(0,0,c.width,c.height);
	};

	Filters.getCanvas = function(w,h) {
	  var c = document.createElement('canvas');
	  c.width = w;
	  c.height = h;
	  return c;
	};

	Filters.filterImage = function(filter, image, var_args) {
	  var args = [this.getPixels(image)];
	  for (var i=2; i<arguments.length; i++) {
		args.push(arguments[i]);
	  }
	  return filter.apply(null, args);
	};
	
	Filters.brightness = function(pixels, adjustment) {
	  var d = pixels.data;
	  for (var i=0; i<d.length; i+=4) {
		d[i] += adjustment;
		d[i+1] += adjustment;
		d[i+2] += adjustment;
	  }
	  return pixels;
	};
	
	Filters.contrast = function(pixels, adjustment) {
		var d = pixels.data;
		
		var factor = (259 * (adjustment + 255)) / (255 * (259 - adjustment));
		for(var i=0;i<d.length;i+=4) {
			d[i] = factor * (d[i] - 128) + 128;
			d[i+1] = factor * (d[i+1] - 128) + 128;
			d[i+2] = factor * (d[i+2] - 128) + 128;
		}
		
		return pixels;
	};
	/*
	Filters.grayscale = function(pixels, adjustment) {
		var d = pixels.data;
		
		for(var i=0;i<d.length;i+=4) {
			var r = d[i];
			var g = d[i + 1];
			var b = d[i + 2];
			var gray = 0.2989*r + 0.5870*g + 0.1140*b; //weights from CCIR 601 spec
			d[i] = gray * adjustment + d[i] * (1-adjustment);
			d[i+1] = gray * adjustment + d[i+1] * (1-adjustment);
			d[i+2] = gray * adjustment + d[i+2] * (1-adjustment);
		}
		
		return pixels;
	};
	*/
	Filters.grayscale = function(pixels, args) {
      var d = pixels.data;
      for (var i=0; i<d.length; i+=4) {
        var r = d[i];
        var g = d[i+1];
        var b = d[i+2];
        // CIE luminance for the RGB
        var v = 0.2126*r + 0.7152*g + 0.0722*b;
        d[i] = d[i+1] = d[i+2] = v
      }
      return pixels;
    };

	Filters.huerotate = function(pixels, adjustment) {
		var d = pixels.data,
			originalData = Filters.getPixels(img).data;
		
		for(var i=0;i<d.length;i+=4) {
			red 	= d[i + 0];
			green 	= d[i + 1];
			blue 	= d[i + 2];
			alpha 	= d[i + 3];

			// skip transparent/semiTransparent pixels
			if (alpha < 200) {
				continue;
			}

			var hsl = rgbToHsl(red, green, blue);
			var hue = hsl.h * 360;

			// change blueish pixels to the new color
			if (hue > 200 && hue < 300) {
				var newRgb = hslToRgb(hsl.h + adjustment, hsl.s, hsl.l);
				d[i + 0] = newRgb.r;
				d[i + 1] = newRgb.g;
				d[i + 2] = newRgb.b;
				d[i + 3] = 255;
			}
		}
		
		return pixels;
	};
	
	Filters.invert = function(pixels, adjustment) {
      var d = pixels.data;
      for (var i=0; i<d.length; i+=4) {
          // red
          d[i] 		= 255 - d[i];
          // green
          d[i + 1] 	= 255 - d[i + 1];
          // blue
          d[i + 2]	= 255 - d[i + 2];
      }
      return pixels;
    };
	
	Filters.opacity = function(pixels, adjustment) {
		//pixels.globalAlpha = adjustment;
		//pixels.fillStyle = "black";
      	return pixels;
    };
    
	Filters.saturate = function(pixels, adjustment) {
		var d = pixels.data;
		
		for(var i=0;i<d.length;i+=4) {
			var r = d[i]; 
			var g = d[i + 1];
			var b = d[i + 2];
			var gray = 0.2989*r + 0.5870*g + 0.1140*b; //weights from CCIR 601 spec
			d[i] = -gray * adjustment + d[i] * (1+adjustment);
			d[i+1] = -gray * adjustment + d[i+1] * (1+adjustment);
			d[i+2] = -gray * adjustment + d[i+2] * (1+adjustment);
			//normalize over- and under-saturated values
			if(d[i] > 255) d[i] = 255;
			if(d[i+1] > 255) d[i] = 255;
			if(d[i+2] > 255) d[i] = 255;
			if(d[i] < 0) d[i] = 0;
			if(d[i+1] < 0) d[i] = 0;
			if(d[i+2] < 0) d[i] = 0;
		}
		
		return pixels;
	};
	
	Filters.sepia = function(pixels, adjustment) {
		var d = pixels.data,
			originalData = Filters.getPixels(img).data;
		
		for(var i=0;i<d.length;i+=4) {
			var red = d[i];
			var green = d[i + 1];
			var blue = d[i + 2];
			var alpha = d[i + 3];

			var outRed = (red * .393) + (green *.769) + (blue * .189); // calculate value for red channel in pixel
			var outGreen = (red * .349) + (green *.686) + (blue * .168);
			var outBlue = (red * .272) + (green *.534) + (blue * .131);

			d[i] = outRed < 255 ? outRed : 255; // check if the value is less than 255, if more set it to 255
			d[i + 1] = outGreen < 255 ? outGreen : 255;
			d[i + 2] = outBlue < 255 ? outBlue : 255
			d[i + 3] = alpha;
		}
		
		return pixels;
	};
	
    Filters.tmpCanvas = document.createElement('canvas');
    Filters.tmpCtx = Filters.tmpCanvas.getContext('2d');
    
	Filters.createImageData = function(w,h) {
      return this.tmpCtx.createImageData(w,h);
    };
        
    Filters.convolute = function(pixels, weights, opaque) {
      var side = Math.round(Math.sqrt(weights.length));
      var halfSide = Math.floor(side/2);

      var src = pixels.data;
      var sw = pixels.width;
      var sh = pixels.height;

      var w = sw;
      var h = sh;
      var output = Filters.createImageData(w, h);
      var dst = output.data;

      var alphaFac = opaque ? 1 : 0;

	  
      for (var y=0; y<h; y++) {
        for (var x=0; x<w; x++) {
          var sy = y;
          var sx = x;
          var dstOff = (y*w+x)*4;
          var r=0, g=0, b=0, a=0;
          for (var cy=0; cy<side; cy++) {
            for (var cx=0; cx<side; cx++) {
              var scy = Math.min(sh-1, Math.max(0, sy + cy - halfSide));
              var scx = Math.min(sw-1, Math.max(0, sx + cx - halfSide));
              var srcOff = (scy*sw+scx)*4;
              var wt = weights[cy*side+cx];
              r += src[srcOff] * wt;
              g += src[srcOff+1] * wt;
              b += src[srcOff+2] * wt;
              a += src[srcOff+3] * wt;
            }
          }
          dst[dstOff] = r;
          dst[dstOff+1] = g;
          dst[dstOff+2] = b;
          dst[dstOff+3] = a + alphaFac*(255-a);
        }
      }
      return output;
    };
	

	function rgbToHsl(r, g, b){
	  r /= 255, g /= 255, b /= 255;
	  var max = Math.max(r, g, b), min = Math.min(r, g, b);
	  var h, s, l = (max + min) / 2;
	  if(max == min){
		h = s = 0; // achromatic
	  }else{
		var d = max - min;
		s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
		switch(max){
		  case r: h = (g - b) / d + (g < b ? 6 : 0); break;
		  case g: h = (b - r) / d + 2; break;
		  case b: h = (r - g) / d + 4; break;
		}
		h /= 6;
	  }
	  return({ h:h, s:s, l:l });
	}

	function hslToRgb(h, s, l){
	  var r, g, b;
	  if(s == 0){
		r = g = b = l; // achromatic
	  }else{
		function hue2rgb(p, q, t){
		  if(t < 0) t += 1;
		  if(t > 1) t -= 1;
		  if(t < 1/6) return p + (q - p) * 6 * t;
		  if(t < 1/2) return q;
		  if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;
		  return p;
		}
		var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
		var p = 2 * l - q;
		r = hue2rgb(p, q, h + 1/3);
		g = hue2rgb(p, q, h);
		b = hue2rgb(p, q, h - 1/3);
	  }
	  return({
		r:Math.round(r * 255),
		g:Math.round(g * 255),
		b:Math.round(b * 255),
	  });
	}
	
	function hiddenOther(showitem) {
      for (var i=0; i<canvases.length; i++) {
        var c = canvases[i];
        if(c.id != showitem)
        	c.style.display = 'none';
      }
	}
	
	setTimeout(function() {
		var formFilter = document.getElementById("filters");
		formFilter.style.display = "block";
	}, 100);
	</script>
</body>
</html>
